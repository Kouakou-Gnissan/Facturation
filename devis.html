<!-- facture-impression.html -->
<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Devis</title>
    <link rel="stylesheet" href="style/devis.css">
    <style>
        @media print {

            * {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            body {
                background: white !important;
            }
        }

        @page {
            size: A4 portrait;
            margin: 0;
        }
    </style>
</head>

<body>
    <div class="devis-a4" id="devis">
        <header class="devis-header">
            <img src="image/logo.png" alt="logo">
            <h4 class="header-text">Solutions d'énergies sécondaires securisées</h4>
        </header>

        <section class="devis-info">
            <div class="card-info">
                <h3>DEVIS</h3>
                <p><strong>REGIME D'IMPOSITION :</strong><span id="regime-imposition"></span></p>
                <p><strong>Numero : </strong><span id="numero-devis"></span></p>
                <p><strong>Date : </strong><span id="date-devis"></span></p>
                <p><strong>Objet : </strong><span id="objet"></span></p>
                <p><strong>Articles : </strong><span id="article"></span></p>
                <p><strong>Validité de l'offre : </strong><span id="validite"></span></p>
                <p><strong>Conditions : </strong><span id="condition"></span></p>
                <p><strong>Garantie : </strong><span id="garantie"></span></p>
            </div>
            <div class="card-info">
                <p><strong>CLIENT : </strong><span id="client-nom"></span></p>
                <p><strong>ATT : </strong><span id="client-att"></span></p>
                <p><strong>Tel : </strong><span id="client-tel"></span></p>
                <p><strong>BP : </strong><span id="client-bp"></span></p>
                <p><strong>CC : </strong><span id="client-cc"></span></p>
                <p><strong>E-mail : </strong><span id="client-email"></span></p>
            </div>
        </section>


        <section class="devis-articles">

            <table>
                <colgroup>
                    <col style="width: 60%;">
                    <col style="width: 8%;">
                    <col style="width: 15%;">
                    <col style="width: 30%;">
                </colgroup>
                <thead>
                    <tr>
                        <th>Description</th>
                        <th>QTE</th>
                        <th>P.U.H.T</th>
                        <th>TOTAL</th>
                    </tr>
                </thead>
                <tbody id="devis-lignes-articles">
                    <!-- Lignes injectées dynamiquement -->
                    <tr>
                        <td class="article linge1">FOURNITURE D'APPAREILLAGES ELECTRIQUES</td>
                        <td class="quantite"></td>
                        <td class="prix"></td>
                        <td class="total"></td>
                    </tr>
                    <tr>
                        <td class="article ligne-paire"></td>
                        <td class="quantite ligne-paire"></td>
                        <td class="prix ligne-paire"></td>
                        <td class="total ligne-paire"></td>
                    </tr>
                    <tr>
                        <td class="article"></td>
                        <td class="quantite"></td>
                        <td class="prix"></td>
                        <td class="total"></td>
                    </tr>
                    <tr>
                        <td class="article ligne-paire"></td>
                        <td class="quantite ligne-paire"></td>
                        <td class="prix ligne-paire"></td>
                        <td class="total ligne-paire"></td>
                    </tr>
                    <tr>
                        <td class="article"></td>
                        <td class="quantite"></td>
                        <td class="prix"></td>
                        <td class="total"></td>
                    </tr>
                    <tr>
                        <td class="article ligne-paire"></td>
                        <td class="quantite ligne-paire"></td>
                        <td class="prix ligne-paire"></td>
                        <td class="total ligne-paire"></td>
                    </tr>
                    <tr>
                        <td class="article"></td>
                        <td class="quantite"></td>
                        <td class="prix"></td>
                        <td class="total"></td>
                    </tr>
                    <tr>
                        <td class="article ligne-paire"></td>
                        <td class="quantite ligne-paire"></td>
                        <td class="prix ligne-paire"></td>
                        <td class="total ligne-paire"></td>
                    </tr>
                    <tr>
                        <td class="article"></td>
                        <td class="quantite"></td>
                        <td class="prix"></td>
                        <td class="total"></td>
                    </tr>
                    <tr>
                        <td class="article ligne-paire"></td>
                        <td class="quantite ligne-paire"></td>
                        <td class="prix ligne-paire"></td>
                        <td class="total ligne-paire"></td>
                    </tr>
                    <tr>
                        <td class="article"></td>
                        <td class="quantite"></td>
                        <td class="prix"></td>
                        <td class="total"></td>
                    </tr>
                    <tr>
                        <td class="article ligne-paire"></td>
                        <td class="quantite ligne-paire"></td>
                        <td class="prix ligne-paire"></td>
                        <td class="total ligne-paire"></td>
                    </tr>
                    <tr>
                        <td class="article"></td>
                        <td class="quantite"></td>
                        <td class="prix"></td>
                        <td class="total"></td>
                    </tr>
                    <tr>
                        <td class="article ligne-paire"></td>
                        <td class="quantite ligne-paire"></td>
                        <td class="prix ligne-paire"></td>
                        <td class="total ligne-paire"></td>
                    </tr>
                    <tr>
                        <td class="article"></td>
                        <td class="quantite"></td>
                        <td class="prix"></td>
                        <td class="total"></td>
                    </tr>
                    <tr>
                        <td class="article ligne-paire"></td>
                        <td class="quantite ligne-paire"></td>
                        <td class="prix ligne-paire"></td>
                        <td class="total ligne-paire"></td>
                    </tr>
                    <tr>
                        <td class="article"></td>
                        <td class="quantite"></td>
                        <td class="prix"></td>
                        <td class="total"></td>
                    </tr>
                    <tr>
                        <td class="article ligne-paire"></td>
                        <td class="quantite ligne-paire"></td>
                        <td class="prix ligne-paire"></td>
                        <td class="total ligne-paire"></td>
                    </tr>
                    <tr>
                        <td class="article"></td>
                        <td class="quantite"></td>
                        <td class="prix"></td>
                        <td class="total"></td>
                    </tr>
                    <tr>
                        <td class="article ligne-paire"></td>
                        <td class="quantite ligne-paire"></td>
                        <td class="prix ligne-paire"></td>
                        <td class="total ligne-paire"></td>
                    </tr>
                </tbody>
            </table>
        </section>

        <section class="devis-total">

            <table>
                <colgroup>
                    <col style="width: 15%;">
                    <col style="width: 15%;">
                    <col style="width: 14.5%;">
                    <col style="width: 14.3%;">
                    <col style="width: 14%;">
                    <col style="width: 25%;">
                </colgroup>
                <thead>
                    <tr>
                        <th>MONTANT TH</th>
                        <th>REMISE %</th>
                        <th>APRES REMISE</th>
                        <th>MAIN D'OEUVRE</th>
                        <th>TVA NON FACTUREE</th>
                        <th>MONTANT TOTAL HT A PAYER</th>
                    </tr>
                </thead>
                <tbody id="devis-lignes-totaux">
                    <!-- Lignes injectées dynamiquement -->
                    <tr>
                        <td class="Montant-th"></td>
                        <td class="remise"></td>
                        <td class="apres-remise"></td>
                        <td class="main-oeuvre"></td>
                        <td class="tva"></td>
                        <td class="montant-ttc"></td>
                    </tr>

                </tbody>
            </table>
        </section>

        <!-- footer du devis -->
        <section class="devis-footer">
            <p><strong>ARRETER LE PRESENT DEVIS A LA SOMME DE :</strong><span id="montant-lettre"></span></p>
            <div class="footer-info">
                <div class="footer-adresse">
                    <p>E-mail: info@l2epci.ci/ info@l2epci.com</p>
                    <p>RC: CI-ABJ-03-2023-B12-05911/ CC: 2304670 K</p>
                    <p>TEL: 2721518402/ SAV: 0705541186/ 0505136487/ 06 BP 800 ABJ 06</p>
                    <p>SARL AU CAPITAL SOCIAL 2.OOO.000 F CFA</p>
                </div>
                <div class="footer-signature">
                    <p><strong>LA DIRECTION COMMERCIALE</strong></p>
                    <img src="image/signature.PNG" alt="cachet de l'entrepise">
                </div>
            </div>

            <div class="footer-partenaire">
                <img src="image/partenaire.PNG" alt="logo partenaire">
            </div>
        </section>
    </div>
    <script>


        window.onload = () => {

            const data = JSON.parse(localStorage.getItem("devisData"));
            if (!data) {
                alert("Aucune donnée trouvée pour l'impression.");
                return;
            }

            // Infos générales
            document.getElementById("numero-devis").textContent = data.numeroDevis;
            document.getElementById("date-devis").textContent = data.dateDevis;

            // Info devis
            document.getElementById("regime-imposition").textContent = data.regime;
            document.getElementById("objet").textContent = data.objet;
            document.getElementById("article").textContent = data.article;
            document.getElementById("validite").textContent = data.validite;
            document.getElementById("condition").textContent = data.condition;
            document.getElementById("garantie").textContent = data.garantie;

            // Infos client
            document.getElementById("client-nom").textContent = data.clientName;
            document.getElementById("client-tel").textContent = data.telephone;
            document.getElementById("client-email").textContent = data.email;
            document.getElementById("client-bp").textContent = data.bp;
            document.getElementById("client-att").textContent = data.att;
            document.getElementById("client-cc").textContent = data.cc;

            // Insertion des articles (à partir de la 2e ligne du tableau)
            const lignes = document.querySelectorAll("#devis-lignes-articles tr");
            for (let i = 1; i < lignes.length && i - 1 < data.articles.length; i++) {
                const articleData = data.articles[i - 1];
                lignes[i].querySelector(".article").textContent = articleData.description;
                lignes[i].querySelector(".quantite").textContent = articleData.quantity;
                lignes[i].querySelector(".prix").textContent = articleData.price;
                lignes[i].querySelector(".total").textContent = articleData.total;
            }

            // Totaux
            const totalRow = document.querySelector("#devis-lignes-totaux tr");
            totalRow.querySelector(".Montant-th").textContent = data.montantHT.toFixed(2);
            totalRow.querySelector(".remise").textContent = data.remise + " %";
            totalRow.querySelector(".apres-remise").textContent = data.apresRemise.toFixed(2);
            totalRow.querySelector(".main-oeuvre").textContent = data.mainOeuvre.toFixed(2);
            totalRow.querySelector(".tva").textContent = data.tva + " %";
            totalRow.querySelector(".montant-ttc").textContent = data.montantTTC.toFixed(2);


            // Montant en lettres (automatique si non fourni)
            if (data.montantLettre && data.montantLettre.trim() !== "") {
                document.getElementById("montant-lettre").textContent = data.montantLettre;
            } else if (data.montantTTC) {
                const montantLettre = numberToWordsFr(Math.round(data.montantTTC));
                document.getElementById("montant-lettre").textContent = montantLettre;
            }


            document.title = `${data.numeroDevis || "000"}`;
            document.getElementById("numero-devis").textContent = data.numeroDevis || "";


            window.print();
            setTimeout(() => window.close(), 1000);
        };



        function numberToWordsFr(n) {
            const unités = ['zéro', 'un', 'deux', 'trois', 'quatre', 'cinq', 'six', 'sept', 'huit', 'neuf'];
            const dizaines = ['dix', 'onze', 'douze', 'treize', 'quatorze', 'quinze', 'seize', 'dix-sept', 'dix-huit', 'dix-neuf'];
            const dizainesUnités = ['', '', 'vingt', 'trente', 'quarante', 'cinquante', 'soixante'];

            function convert(n) {
                if (n < 10) return unités[n];
                if (n < 20) return dizaines[n - 10];
                if (n < 70) {
                    let d = Math.floor(n / 10), u = n % 10;
                    return dizainesUnités[d] + (u === 1 ? '-et-un' : u > 0 ? '-' + unités[u] : '');
                }
                if (n < 80) return 'soixante-' + convert(n - 60);
                if (n < 100) return 'quatre-vingt' + (n === 80 ? 's' : '-' + convert(n - 80));
                if (n < 200) return 'cent' + (n > 100 ? ' ' + convert(n - 100) : '');
                if (n < 1000) {
                    let c = Math.floor(n / 100), r = n % 100;
                    return unités[c] + ' cent' + (r > 0 ? ' ' + convert(r) : '');
                }
                if (n < 2000) return 'mille' + (n > 1000 ? ' ' + convert(n - 1000) : '');
                if (n < 1000000) {
                    let m = Math.floor(n / 1000), r = n % 1000;
                    return convert(m) + ' mille' + (r > 0 ? ' ' + convert(r) : '');
                }
                if (n < 2000000) return 'un million' + (n > 1000000 ? ' ' + convert(n - 1000000) : '');
                return convert(Math.floor(n / 1000000)) + ' millions' + (n % 1000000 > 0 ? ' ' + convert(n % 1000000) : '');
            }

            return convert(n) + ' francs CFA./.';
        }
    </script>

</body>

</html>